// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// Enums
enum UserRole {
  ADMIN
  MANAGER
  STAFF
}

enum Gender {
  male
  female
}

enum WorkStatus {
  working
  resigned
  probation
  leave
}

// Models
model User {
  id            Int      @id @default(autoincrement())
  email         String   @unique
  password_hash String
  role          UserRole @default(STAFF)
  refresh_token String?

  created_at DateTime  @default(now())
  updated_at DateTime  @updatedAt
  is_deleted Boolean   @default(false)
  deleted_at DateTime?

  // Relations
  // A user is associated with one employee
  employee_id Int?      @unique
  employee    Employee? @relation(fields: [employee_id], references: [id])

  @@map("users")
}

model Employee {
  id              Int        @id @default(autoincrement())
  full_name       String
  gender          Gender?
  dob             DateTime?
  identity_number String?    @unique
  phone           String?    @unique
  email           String?    @unique
  address         String?
  hire_date       DateTime?
  work_status     WorkStatus @default(working)

  created_at DateTime  @default(now())
  updated_at DateTime  @updatedAt
  is_deleted Boolean   @default(false)
  deleted_at DateTime?

  // Relations
  // An employee can belong to one department
  department_id Int?
  department    Department? @relation("DepartmentEmployees", fields: [department_id], references: [id])

  // An employee can manage one department or none
  managing_department Department? @relation("DepartmentManager")

  // An employee can hold one position
  position_id Int?
  position    Position? @relation(fields: [position_id], references: [id])

  // An employee can have multiple attendance records
  // attendances Attendance[]

  // An employee can have one user account
  user_account User?

  @@map("employees")
}

model Department {
  id          Int     @id @default(autoincrement())
  name        String
  code        String  @unique
  description String?
  status      Boolean @default(true) // active/inactive

  created_at DateTime  @default(now())
  updated_at DateTime  @updatedAt
  is_deleted Boolean   @default(false)
  deleted_at DateTime?

  // Relations
  // A department can have one manager (an employee)
  manager_id Int?      @unique
  manager    Employee? @relation("DepartmentManager", fields: [manager_id], references: [id])

  // A department can have multiple employees
  employees Employee[] @relation("DepartmentEmployees")

  @@map("departments")
}

model Position {
  id          Int     @id @default(autoincrement())
  name        String
  description String?
  status      Boolean @default(true) // active/inactive

  created_at DateTime  @default(now())
  updated_at DateTime  @updatedAt
  is_deleted Boolean   @default(false)
  deleted_at DateTime?

  // Relations
  // A position can be held by multiple employees
  employees Employee[]

  @@map("positions")
}

// model Attendance {
//   id          Int      @id @default(autoincrement())
//   employee_id Int
//   employee    Employee @relation(fields: [employee_id], references: [id])

//   check_in      DateTime?
//   check_out     DateTime?
//   working_hours Float?
//   note          String?

//   @@map("attendances")
// }
